<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTMR CLOUD MANAGER 2026</title>
    
    <script src="https://www.gstatic.com"></script>
    <script src="https://www.gstatic.com"></script>

    <style>
        :root { --primary: #5C6AC4; --ot-color: #0984e3; --danger: #d63031; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; }
        .container { padding: 20px; max-width: 1400px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-green { background: #28a745; color: white; }
        .btn-red { background: var(--danger); color: white; }
        
        /* Table */
        .table-container { overflow-x: auto; background: white; border-radius: 8px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #eee; padding: 12px; text-align: center; }
        th { background: #f8f9fa; }
        .cell-shift { cursor: pointer; color: white; font-weight: bold; border-radius: 4px; }
        
        /* Staff List */
        .staff-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-top: 15px; }
        .staff-card { padding: 10px; border: 1px solid #ddd; border-radius: 8px; background: #fff; display: flex; justify-content: space-between; align-items: center; }

        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                  background: white; padding: 25px; border-radius: 12px; z-index: 1001; width: 90%; max-width: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.4); }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div class="container">
    <!-- LOGIN -->
    <div id="loginSection" class="card" style="width: 320px; margin: 100px auto; text-align: center;">
        <h2 style="color:var(--primary)">BTMR ADMIN 2026</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button class="btn-blue" onclick="checkLogin()" style="width:100%">LOG MASUK</button>
        <p id="loginError" style="color:red; font-size:12px;"></p>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" style="display:none;">
        <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h1>Jadual Pasukan BTMR 2026</h1>
            <div id="clock" style="font-weight: bold; color: var(--primary);"></div>
        </div>

        <!-- DAFTAR PEGAWAI (PAGE 2 CONTENT) -->
        <div class="card no-print">
            <h3>ðŸ‘¥ Pendaftaran Pegawai</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="s_name" placeholder="Nama Penuh" style="flex:2">
                <select id="s_team" style="flex:1">
                    <option value="PASUKAN A">Pasukan A</option>
                    <option value="PASUKAN B">Pasukan B</option>
                    <option value="PASUKAN C">Pasukan C</option>
                    <option value="PASUKAN D">Pasukan D</option>
                </select>
                <button class="btn-green" onclick="addStaff()">+ DAFTAR</button>
            </div>
            <div id="staffDisplay" class="staff-grid"></div>
        </div>

        <!-- JADUAL TUGASAN (PAGE 1 CONTENT) -->
        <div class="card" style="padding:0;">
            <div style="padding: 15px;" class="no-print">
                <label>Pilih Bulan:</label>
                <select id="monthSelect" onchange="renderTable()" style="width: 200px;"></select>
            </div>
            <div class="table-container" id="calendarContainer"></div>
        </div>
    </div>
</div>

<!-- MODAL UPDATE -->
<div id="overlay" onclick="closeModal()"></div>
<div id="statusModal" class="modal">
    <h3 id="modalTitle">Kemaskini</h3>
    <select id="statusType">
        <option value="NORMAL">Normal</option>
        <option value="CS">CS (Cuti Sakit)</option>
        <option value="OT">OT (Overtime)</option>
    </select>
    <textarea id="globalNote" placeholder="Nota..."></textarea>
    <button class="btn-blue" onclick="saveStatus()">SIMPAN</button>
</div>

<script>
// CONFIG FIREBASE (Sila masukkan API Key anda)
const firebaseConfig = {
    apiKey: "AIzaSy...",
    authDomain: "projek-anda.firebaseapp.com",
    databaseURL: "https://projek-anda-default-rtdb.firebaseio.com",
    projectId: "projek-anda",
    storageBucket: "projek-anda.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abcdef"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let currentCell = null;

function checkLogin() {
    if(document.getElementById('username').value === "admin" && document.getElementById('password').value === "btmr2026") {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        init();
    } else { alert("Akses Ditolak!"); }
}

function init() {
    const mSelect = document.getElementById('monthSelect');
    ["Januari","Februari","Mac","April","Mei","Jun","Julai","Ogos","September","Oktober","November","Disember"].forEach((m, i) => {
        let opt = document.createElement('option'); opt.value = i; opt.text = m;
        opt.selected = (i === new Date().getMonth()); mSelect.appendChild(opt);
    });
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleString('ms-MY'); }, 1000);
    loadStaff();
    renderTable();
}

// FUNGSI DAFTAR PEGAWAI
function addStaff() {
    const name = document.getElementById('s_name').value;
    const team = document.getElementById('s_team').value;
    if(!name) return alert("Masukkan nama!");
    db.ref('staff').push({ name, team });
    document.getElementById('s_name').value = "";
}

function loadStaff() {
    db.ref('staff').on('value', (snap) => {
        const data = snap.val();
        let html = "";
        for(let id in data) {
            html += `<div class="staff-card">
                <span><b>${data[id].name}</b> (${data[id].team})</span>
                <button class="btn-red" onclick="deleteStaff('${id}')" style="padding:2px 8px;">X</button>
            </div>`;
        }
        document.getElementById('staffDisplay').innerHTML = html;
    });
}

function deleteStaff(id) { db.ref('staff/' + id).remove(); }

// FUNGSI JADUAL
function getBaseShift(team, day) {
    const cycle = (day + team.length) % 4;
    const shifts = [
        {c:'PAGI', col:'#27ae60'}, {c:'PTG', col:'#f39c12'}, 
        {c:'MLM', col:'#2c3e50'}, {c:'OFF', col:'#95a5a6'}
    ];
    return shifts[cycle];
}

function renderTable() {
    const month = parseInt(document.getElementById('monthSelect').value);
    const days = new Date(2026, month + 1, 0).getDate();
    const teams = ["PASUKAN A", "PASUKAN B", "PASUKAN C", "PASUKAN D"];
    
    let html = `<table><tr><th>Tarikh</th>` + teams.map(t => `<th>${t}</th>`).join('') + `</tr>`;
    for(let d=1; d<=days; d++) {
        html += `<tr><td>${d}/${month+1}</td>`;
        teams.forEach(t => {
            const shift = getBaseShift(t, d);
            const cellId = `cell_${t.replace(' ','_')}_${month}_${d}`;
            html += `<td id="${cellId}" class="cell-shift" style="background:${shift.col}" onclick="openModal('${cellId}')">${shift.code}</td>`;
        });
        html += `</tr>`;
    }
    document.getElementById('calendarContainer').innerHTML = html + `</table>`;
}

function openModal(id) {
    currentCell = id;
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('statusModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('statusModal').style.display = 'none';
}

function saveStatus() {
    const type = document.getElementById('statusType').value;
    const note = document.getElementById('globalNote').value;
    const el = document.getElementById(currentCell);
    if(type !== "NORMAL") {
        el.innerHTML = `<b>${type}</b><br><small>${note}</small>`;
        el.style.background = "#d63031";
    }
    closeModal();
}
</script>
</body>
</html>
